From 4f478357ae21efd299735f678889a60ea8291d88 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Sebastian=20Dr=C3=B6ge?= <sebastian@centricular.com>
Date: Fri, 20 Jan 2017 17:16:10 +0200
Subject: [PATCH] avidemux: Stop reading a ncdt sub-tag if it goes behind the
 surrounding tag

https://bugzilla.gnome.org/show_bug.cgi?id=777532
---
 gst/avi/gstavidemux.c | 3 +++
 1 file changed, 3 insertions(+)

Index: gst-plugins-good1.0-1.8.3/gst/avi/gstavidemux.c
===================================================================
--- gst-plugins-good1.0-1.8.3.orig/gst/avi/gstavidemux.c	2017-03-23 10:23:39.935477823 -0400
+++ gst-plugins-good1.0-1.8.3/gst/avi/gstavidemux.c	2017-03-23 10:23:39.931477775 -0400
@@ -3898,6 +3898,9 @@
           ptr += 4;
           left -= 4;
 
+          if (sub_size > tsize)
+            break;
+
           GST_DEBUG_OBJECT (avi, "sub-tag %u, size %u", sub_tag, sub_size);
           /* http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/Nikon.html#NCTG
            * for some reason the sub_tag has a +2 offset
